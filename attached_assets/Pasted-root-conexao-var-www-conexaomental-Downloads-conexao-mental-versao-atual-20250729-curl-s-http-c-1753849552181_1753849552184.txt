root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# curl -s http://conexaomental.online | grep -i "sessão de acolhimento"
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# cd /var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # BAIXAR CÓDIGO ATUALIZADO
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# git pull origin main
From https://github.com/Terapeutawelder/clinicaconexaomental
 * branch            main       -> FETCH_HEAD
Already up to date.
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# npm install

up to date, audited 455 packages in 7s

58 packages are looking for funding
  run `npm fund` for details

3 low severity vulnerabilities

To address all issues, run:
  npm audit fix

Run `npm audit` for details.
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# npm run build

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

sh: 1: vite: not found
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # RESETAR APLICAÇÃO
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# pm2 delete all
[PM2] Applying action deleteProcessId on app [all](ids: [ 0 ])
[PM2] [conexaomental](0) ✓
┌────┬───────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name      │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
└────┴───────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# pm2 kill
[PM2][WARN] No process found
[PM2] [v] All Applications Stopped
[PM2] [v] PM2 Daemon Stopped
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # CONFIGURAR .env
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# echo 'NODE_ENV=production' > .env
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# echo 'DATABASE_URL=postgresql://cloud_admin@localhost:5432/conexaomental?sslmode=disable' >> .env
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # TESTAR PRODUCTION MODE
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# export NODE_ENV=production
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# node dist/index.js &
[1] 46980
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# sleep 20
node:internal/modules/esm/resolve:873
  throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
        ^

Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'vite' imported from /var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729/dist/index.js
    at packageResolve (node:internal/modules/esm/resolve:873:9)
    at moduleResolve (node:internal/modules/esm/resolve:946:18)
    at defaultResolve (node:internal/modules/esm/resolve:1188:11)
    at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:642:12)
    at #cachedDefaultResolve (node:internal/modules/esm/loader:591:25)
    at ModuleLoader.resolve (node:internal/modules/esm/loader:574:38)
    at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:236:38)
    at ModuleJob._link (node:internal/modules/esm/module_job:130:49) {
  code: 'ERR_MODULE_NOT_FOUND'
}

Node.js v20.19.4
[1]+  Exit 1                  node dist/index.js
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# curl -s http://127.0.0.1:5000 | grep "vite" && echo "❌ DEV" || echo "✅ PRODUCTION"
✅ PRODUCTION
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# pkill -f "node dist"
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # INICIAR COM PM2 E NGINX
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# pm2 start dist/index.js --name "conexaomental"
[PM2] Spawning PM2 daemon with pm2_home=/root/.pm2
[PM2] PM2 Successfully daemonized
[PM2] Starting /var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729/dist/index.js in fork_mode (1 instance)
[PM2] Done.
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ conexaomental    │ default     │ 1.0.0   │ fork    │ 47304    │ 0s     │ 0    │ online    │ 0%       │ 38.3mb   │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# sleep 30
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# sudo tee /etc/nginx/sites-available/conexaomental << 'EOF'
> server {
>     listen 80 default_server;
>     server_name conexaomental.online www.conexaomental.online;
>     location / {
>         proxy_pass http://127.0.0.1:5000;
>         proxy_set_header Host $host;
>         proxy_set_header X-Real-IP $remote_addr;
>         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
>         proxy_set_header X-Forwarded-Proto $scheme;
>     }
> }
> EOF
server {
    listen 80 default_server;
    server_name conexaomental.online www.conexaomental.online;
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# sudo nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# sudo systemctl reload nginx
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # TESTE FINAL
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# curl -s http://conexaomental.online | wc -c
166
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# curl -s http://conexaomental.online | grep -i "sessão de acolhimento"
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# ^C
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# cd /var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # PARAR TUDO E LIMPAR
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# pm2 delete all
[PM2] Applying action deleteProcessId on app [all](ids: [ 0 ])
[PM2] [conexaomental](0) ✓
┌────┬───────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name      │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
└────┴───────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# pm2 kill
[PM2][WARN] No process found
[PM2] [v] All Applications Stopped
[PM2] [v] PM2 Daemon Stopped
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# rm -rf node_modules dist package-lock.json
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # INSTALAR VITE GLOBALMENTE  
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# npm install -g vite esbuild typescript tsx

added 17 packages in 12s

7 packages are looking for funding
  run `npm fund` for details
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # REINSTALAR DEPENDÊNCIAS
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# npm install

added 459 packages, and audited 460 packages in 2m

58 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # VERIFICAR VITE
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# which vite
/usr/bin/vite
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# npm list vite
rest-express@1.0.0 /var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729
└── (empty)

root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # GERAR BUILD CORRETO
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# npm run build

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

failed to load config from /var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729/vite.config.ts
error during build:
Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'vite' imported from /var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729/node_modules/.vite-temp/vite.config.ts.timestamp-1753849442694-53d0e4c0d068d.mjs
    at packageResolve (node:internal/modules/esm/resolve:873:9)
    at moduleResolve (node:internal/modules/esm/resolve:946:18)
    at defaultResolve (node:internal/modules/esm/resolve:1188:11)
    at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:642:12)
    at #cachedDefaultResolve (node:internal/modules/esm/loader:591:25)
    at ModuleLoader.resolve (node:internal/modules/esm/loader:574:38)
    at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:236:38)
    at ModuleJob._link (node:internal/modules/esm/module_job:130:49)
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # SE BUILD FUNCIONAR, TESTAR
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# export NODE_ENV=production
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# node dist/index.js &
[1] 52178
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# sleep 15
node:internal/modules/cjs/loader:1215
  throw err;
  ^

Error: Cannot find module '/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729/dist/index.js'
    at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
    at Module._load (node:internal/modules/cjs/loader:1043:27)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
    at node:internal/main/run_main_module:28:49 {
  code: 'MODULE_NOT_FOUND',
  requireStack: []
}

Node.js v20.19.4
[1]+  Exit 1                  node dist/index.js
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# curl -s http://127.0.0.1:5000 | wc -c
0
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# pkill -f "node dist"
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # SE LOCAL >10KB, USAR PM2
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# pm2 start dist/index.js --name "conexaomental"
[PM2] Spawning PM2 daemon with pm2_home=/root/.pm2
[PM2] PM2 Successfully daemonized
[PM2][ERROR] Script not found: /var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729/dist/index.js
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# sleep 20
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# # TESTAR DOMÍNIO
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# curl -s http://conexaomental.online | wc -c
166
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# curl -s http://conexaomental.online | grep -i "sessão de acolhimento"
root@conexao:/var/www/conexaomental/Downloads/conexao-mental-versao-atual-20250729# 